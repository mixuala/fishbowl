<ion-header>
  <ion-toolbar color="success">
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>
      Player Entry
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

  <!-- grid mode -->
  <ion-grid no-padding>
    <ion-row>
        <ion-col size="12" size-sm="8" offset-sm="2" offset-x="4" size-xl="4">
          <ion-card  *ngIf="game$ | async as game">
            <ion-card-header color="tertiary">
              <ion-card-title>
                {{game.label}}
              </ion-card-title>
              <ion-card-subtitle>
                Fishbowl
              </ion-card-subtitle>
            </ion-card-header>
              
            <ion-card-content>

              <div class="game-time ion-text-center" *ngIf="stash.activeGame==false">
                <app-countdown-timer fill="time" [end]="game.gameTime" [units]="{from: 'day', to: 'second'}" stopAtZero="true"></app-countdown-timer>
                <ion-text  color="dark">
                  Game Time: {{ game.gameTime | appTimeAgo:"ddd, MMM D @ h:mma" }} 
                </ion-text>
                <ion-item-divider></ion-item-divider>
              </div>

            <form [formGroup]="entryForm" (ngSubmit)="doEntry()">

              <ion-list class="inputs-list" lines="full">
                <ion-item class="input-item">
                  <ion-label position="stacked">player name</ion-label>
                  <ion-input type="text" placeholder="name" formControlName="name" clearInput autocapitalize="word" inputmode="text"></ion-input>
                </ion-item>
                <div class="error-container">
                  <ng-container *ngFor="let validation of validation_messages.name">
                    <div class="error-message" *ngIf="entryForm.get('name').hasError(validation.type) && (entryForm.get('name').dirty || entryForm.get('name').touched)">
                      <ion-icon name="information-circle-outline"></ion-icon>
                      <span>{{ validation.message }}</span>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="entryForm.get('name').hasError('unique') && (entryForm.get('name').dirty || entryForm.get('name').touched) && doPlayerEntryLookup()">
                    <ion-grid><ion-row>
                      <ion-col>
                        <ion-text color="tertiary">That name is already taken. Is that your entry?</ion-text>
                      </ion-col>
                      </ion-row><ion-row>
                      <ion-col size="4">
                        <ion-button color="tertiary" expand="block" (click)="onTakePlayerIdentity(false)"> No </ion-button>
                      </ion-col>
                      <ion-col size="8">
                        <ion-button color="success" expand="block" (click)="onTakePlayerIdentity($event)"> Yes </ion-button>
                      </ion-col>
                    </ion-row>
                    </ion-grid>
                  </ng-container>
                </div>

                <ion-item-divider>
                </ion-item-divider>

                <ion-item>
                  <ion-label class="ion-text-wrap">
                    <ion-note color="dark">
                      Please provide 3 secret words which will be revealed during the game.
                    </ion-note>
                  </ion-label>
                </ion-item>

                <ion-item class="input-item">
                  <ion-label position="stacked">Provide 3 nouns</ion-label>
                  <ion-input type="text" placeholder="a Person, Place, or Thing" formControlName="word_1" clearInput autocapitalize="word" inputmode="text"></ion-input>
                </ion-item>
                <div class="error-container">
                  <ng-container *ngFor="let validation of validation_messages.word">
                    <div class="error-message" *ngIf="entryForm.get('word_1').hasError(validation.type) && (entryForm.get('word_1').dirty || entryForm.get('word_1').touched)">
                      <ion-icon name="information-circle-outline"></ion-icon>
                      <span>{{ validation.message }}</span>
                    </div>
                  </ng-container>
                </div>

                <ion-item class="input-item">
                  <ion-input type="text" placeholder="like 'fishbowl'" formControlName="word_2" clearInput autocapitalize="word" inputmode="text"></ion-input>
                </ion-item>
                <div class="error-container">
                  <ng-container *ngFor="let validation of validation_messages.word">
                    <div class="error-message" *ngIf="entryForm.get('word_2').hasError(validation.type) && (entryForm.get('word_2').dirty || entryForm.get('word_2').touched)">
                      <ion-icon name="information-circle-outline"></ion-icon>
                      <span>{{ validation.message }}</span>
                    </div>
                  </ng-container>
                </div>

                <ion-item class="input-item">
                  <ion-input type="text" placeholder="or 'Dory'" formControlName="word_3" clearInput autocapitalize="word" inputmode="text"></ion-input>
                </ion-item>
                <div class="error-container">
                  <ng-container *ngFor="let validation of validation_messages.word">
                    <div class="error-message" *ngIf="entryForm.get('word_3').hasError(validation.type) && (entryForm.get('word_3').dirty || entryForm.get('word_3').touched)">
                      <ion-icon name="information-circle-outline"></ion-icon>
                      <span>{{ validation.message }}</span>
                    </div>
                  </ng-container>
                </div>
          
              </ion-list>
          
              <ion-button class="login-btn" type="submit" expand="block" [disabled]="!entryForm.valid">Submit</ion-button>
            </form>
            
            
            </ion-card-content>
          </ion-card>
        </ion-col>
    </ion-row>
  </ion-grid>

</ion-content>
